<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shadowtech Dev Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #05060a;
  --bg-alt: #101321;
  --panel: #141827;
  --accent: #4b8cff;
  --accent-soft: rgba(75, 140, 255, 0.2);
  --accent-strong: #7b5cff;
  --text: #f5f7ff;
  --muted: #9aa0c2;
  --danger: #ff4b81;
  --border: #22263a;
  --radius: 8px;
  --shadow: 0 0 25px rgba(0,0,0,0.6);
  --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: var(--font);
  background: radial-gradient(circle at top, #151a33 0, #05060a 55%);
  color: var(--text);
  height: 100vh;
}

/* LOGIN SCREEN */
#login-screen {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at top, #151a33 0, #05060a 55%);
  z-index: 50;
}

#login-box {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 18px 20px;
  width: 340px;
  box-shadow: var(--shadow);
}

#login-box h1 {
  margin: 0 0 6px;
  font-size: 1.3rem;
}

#login-box p {
  margin: 0 0 12px;
  font-size: 0.85rem;
  color: var(--muted);
}

#login-tabs {
  display: flex;
  margin-bottom: 10px;
  border-radius: 999px;
  background: #05060f;
  padding: 2px;
}

.login-tab {
  flex: 1;
  text-align: center;
  padding: 6px 0;
  font-size: 0.8rem;
  cursor: pointer;
  border-radius: 999px;
  color: var(--muted);
}

.login-tab.active {
  background: var(--accent);
  color: #fff;
}

#login-box input {
  width: 100%;
  padding: 8px;
  margin-bottom: 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: #05060f;
  color: var(--text);
}

#login-error {
  font-size: 0.8rem;
  color: var(--danger);
  min-height: 16px;
  margin-bottom: 6px;
}

#login-box button {
  width: 100%;
}

/* APP LAYOUT */
#app {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* SIDEBAR */
#sidebar {
  width: 250px;
  background: linear-gradient(180deg, #0b0e18, #05060a);
  border-right: 1px solid var(--border);
  padding: 16px;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow);
}

#logo {
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  font-size: 0.9rem;
  margin-bottom: 4px;
}

#logo span {
  color: var(--accent);
}

#subtitle {
  font-size: 0.75rem;
  color: var(--muted);
  margin-bottom: 16px;
}

.sidebar-section-title {
  font-size: 0.75rem;
  text-transform: uppercase;
  color: var(--muted);
  margin: 12px 0 6px;
}

.sidebar-btn {
  padding: 8px 10px;
  margin-bottom: 6px;
  background: transparent;
  border-radius: 6px;
  border: 1px solid transparent;
  cursor: pointer;
  text-align: left;
  color: var(--muted);
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.sidebar-btn span.icon {
  width: 20px;
  text-align: center;
}

.sidebar-btn:hover {
  background: var(--accent-soft);
  color: var(--text);
}

.sidebar-btn.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent-strong);
}

#sidebar-footer {
  margin-top: auto;
  font-size: 0.7rem;
  color: var(--muted);
  border-top: 1px solid var(--border);
  padding-top: 8px;
}

/* MAIN WRAPPER (TOPBAR + CONTENT) */
#main-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* TOPBAR */
#topbar {
  height: 46px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 14px;
  border-bottom: 1px solid var(--border);
  background: rgba(5,6,10,0.9);
  backdrop-filter: blur(10px);
}

#topbar-left {
  font-size: 0.85rem;
  color: var(--muted);
}

#topbar-right {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.8rem;
}

#notif-dot {
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--accent);
  box-shadow: 0 0 8px var(--accent);
}

#topbar-user {
  display: flex;
  align-items: center;
  gap: 6px;
}

#topbar-avatar {
  width: 24px;
  height: 24px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--accent), var(--accent-strong));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
}

/* MAIN CONTENT */
#main {
  flex: 1;
  padding: 18px 20px;
  overflow-y: auto;
}

.page {
  display: none;
}

.page.active {
  display: block;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}

.page-header h1 {
  margin: 0;
  font-size: 1.4rem;
}

.page-header p {
  margin: 4px 0 0;
  font-size: 0.85rem;
  color: var(--muted);
}

/* GRID / CARDS */
.grid {
  display: grid;
  gap: 14px;
}

.grid-2 {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

.grid-3 {
  grid-template-columns: repeat(3, minmax(0, 1fr));
}

.card {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 12px 14px;
  box-shadow: var(--shadow);
  font-size: 0.9rem;
}

.card h2 {
  margin: 0 0 6px;
  font-size: 1rem;
}

.card small {
  color: var(--muted);
}

/* BUTTONS */
.btn {
  padding: 7px 12px;
  border-radius: 999px;
  border: 1px solid transparent;
  background: var(--accent);
  color: #fff;
  font-size: 0.85rem;
  cursor: pointer;
}

.btn.secondary {
  background: transparent;
  border-color: var(--accent-soft);
  color: var(--text);
}

.btn.danger {
  background: var(--danger);
}

.btn.small {
  padding: 4px 8px;
  font-size: 0.75rem;
}

.btn + .btn {
  margin-left: 6px;
}

/* FORUM */
#forum-actions {
  margin-bottom: 10px;
}

#forum-posts {
  margin-top: 10px;
}

.post {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 10px 12px;
  margin-bottom: 10px;
}

.post-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.8rem;
  color: var(--muted);
}

.post-title {
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
}

.post-body {
  font-size: 0.9rem;
  margin-bottom: 6px;
}

.post-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 0.75rem;
  color: var(--muted);
}

.reply {
  margin-top: 6px;
  padding-left: 10px;
  border-left: 2px solid var(--accent-soft);
  font-size: 0.8rem;
}

/* WIKI */
#wiki-layout {
  display: grid;
  grid-template-columns: 220px minmax(0, 1fr);
  gap: 12px;
}

#wiki-sidebar {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 10px;
  font-size: 0.85rem;
}

#wiki-sidebar h3 {
  margin: 0 0 8px;
  font-size: 0.9rem;
}

.wiki-topic {
  padding: 6px 8px;
  border-radius: 6px;
  cursor: pointer;
  color: var(--muted);
}

.wiki-topic:hover,
.wiki-topic.active {
  background: var(--accent-soft);
  color: var(--text);
}

#wiki-content {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 12px 14px;
  font-size: 0.9rem;
}

#wiki-content h2 {
  margin-top: 0;
}

/* CODE BLOCKS */
.code-block {
  background: #05060f;
  border-radius: 6px;
  border: 1px solid var(--border);
  padding: 8px;
  font-family: "Consolas", "Fira Code", monospace;
  font-size: 0.8rem;
  overflow-x: auto;
}

/* PROFILE */
.profile-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--accent), var(--accent-strong));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
}

/* TASK BOARD */
#task-board {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 10px;
}

.task-column {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 10px;
  font-size: 0.85rem;
}

.task-column h3 {
  margin: 0 0 6px;
  font-size: 0.9rem;
}

.task-item {
  background: #05060f;
  border-radius: 6px;
  border: 1px solid var(--border);
  padding: 6px 8px;
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.task-item span {
  font-size: 0.8rem;
}

/* MODAL */
#modal-bg {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 20;
}

#modal {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 14px;
  width: 320px;
  box-shadow: var(--shadow);
  font-size: 0.9rem;
}

#modal h3 {
  margin-top: 0;
}

#modal input,
#modal textarea,
#modal select {
  width: 100%;
  padding: 7px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: #05060f;
  color: var(--text);
  font-family: var(--font);
  font-size: 0.85rem;
}

/* EMOJI PICKER */
#emoji-picker {
  margin-top: 6px;
  font-size: 1.1rem;
}

#emoji-picker span {
  cursor: pointer;
  margin-right: 4px;
}

/* RESPONSIVE */
@media (max-width: 900px) {
  #sidebar {
    display: none;
  }
  #app {
    flex-direction: column;
  }
  #main {
    padding: 12px;
  }
  .grid-2, .grid-3 {
    grid-template-columns: minmax(0, 1fr);
  }
  #task-board {
    grid-template-columns: minmax(0, 1fr);
  }
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-screen">
  <div id="login-box">
    <h1>Shadowtech Dev</h1>
    <p>Local dev hub with login. Accounts stored in your browser only.</p>

    <div id="login-tabs">
      <div class="login-tab active" data-mode="login">Login</div>
      <div class="login-tab" data-mode="register">Register</div>
    </div>

    <div id="login-forms">
      <input id="login-username" placeholder="Username">
      <input id="login-password" type="password" placeholder="Password">
      <div id="login-error"></div>
      <button class="btn" onclick="handleAuth()">Continue</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <!-- SIDEBAR -->
  <div id="sidebar">
    <div id="logo">Shadowtech<span>Dev</span></div>
    <div id="subtitle">Developer control hub</div>

    <div class="sidebar-section-title">Main</div>
    <button class="sidebar-btn active" data-page="home">
      <span class="icon">üè†</span> Home
    </button>
    <button class="sidebar-btn" data-page="forum">
      <span class="icon">üí¨</span> Forum
    </button>
    <button class="sidebar-btn" data-page="wiki">
      <span class="icon">üìò</span> Wiki
    </button>
    <button class="sidebar-btn" data-page="tasks">
      <span class="icon">üìã</span> Tasks
    </button>

    <div class="sidebar-section-title">Dev</div>
    <button class="sidebar-btn" data-page="changelog">
      <span class="icon">üìú</span> Changelog
    </button>
    <button class="sidebar-btn" data-page="snippets">
      <span class="icon">üíª</span> Snippets
    </button>

    <div class="sidebar-section-title">User</div>
    <button class="sidebar-btn" data-page="profile">
      <span class="icon">üë§</span> Profile
    </button>
    <button class="sidebar-btn" data-page="settings">
      <span class="icon">‚öôÔ∏è</span> Settings
    </button>

    <div id="sidebar-footer">
      Shadowtech Dev Hub<br>
      <span id="footer-year"></span>
    </div>
  </div>

  <!-- MAIN WRAPPER -->
  <div id="main-wrapper">
    <!-- TOPBAR -->
    <div id="topbar">
      <div id="topbar-left">
        <span id="topbar-page-label">Home</span>
      </div>
      <div id="topbar-right">
        <div id="notif-dot"></div>
        <div id="topbar-user">
          <div id="topbar-avatar">SD</div>
          <span id="topbar-name">Guest</span>
          <button class="btn small secondary" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main">
      <!-- HOME -->
      <div id="page-home" class="page active">
        <div class="page-header">
          <div>
            <h1>Shadowtech Dev Hub</h1>
            <p>Central place for your dev notes, forum, wiki, tasks, and tools.</p>
          </div>
        </div>

        <div class="grid grid-3">
          <div class="card">
            <h2>Forum</h2>
            <small>Post updates, ideas, bugs, or notes.</small>
            <p>Use the forum to log progress, brainstorm features, or track issues.</p>
            <button class="btn small" onclick="goTo('forum')">Open Forum</button>
          </div>
          <div class="card">
            <h2>Wiki</h2>
            <small>Document your systems.</small>
            <p>Keep a structured knowledge base for commands, flows, and architecture.</p>
            <button class="btn small" onclick="goTo('wiki')">Open Wiki</button>
          </div>
          <div class="card">
            <h2>Tasks</h2>
            <small>Track what you‚Äôre working on.</small>
            <p>Use the task board to move items from To‚ÄëDo to Done.</p>
            <button class="btn small" onclick="goTo('tasks')">Open Tasks</button>
          </div>
        </div>
      </div>

      <!-- FORUM -->
      <div id="page-forum" class="page">
        <div class="page-header">
          <div>
            <h1>Forum</h1>
            <p>Post messages, reply, and keep a dev log. Stored locally per user.</p>
          </div>
          <div>
            <button class="btn small" onclick="openModal('post')">New Post</button>
          </div>
        </div>

        <div id="forum-actions">
          <button class="btn small secondary" onclick="clearForum()">Clear All Posts</button>
        </div>

        <div id="forum-posts"></div>
      </div>

      <!-- WIKI -->
      <div id="page-wiki" class="page">
        <div class="page-header">
          <div>
            <h1>Wiki</h1>
            <p>Quick reference for your Shadowtech Dev ecosystem.</p>
          </div>
        </div>

        <div id="wiki-layout">
          <div id="wiki-sidebar">
            <h3>Topics</h3>
            <div id="wiki-topics"></div>
          </div>
          <div id="wiki-content"></div>
        </div>
      </div>

      <!-- TASKS -->
      <div id="page-tasks" class="page">
        <div class="page-header">
          <div>
            <h1>Tasks</h1>
            <p>Simple board: To‚ÄëDo, In Progress, Done.</p>
          </div>
          <div>
            <button class="btn small" onclick="openModal('task')">New Task</button>
          </div>
        </div>

        <div id="task-board">
          <div class="task-column">
            <h3>To‚ÄëDo</h3>
            <div id="tasks-todo"></div>
          </div>
          <div class="task-column">
            <h3>In Progress</h3>
            <div id="tasks-progress"></div>
          </div>
          <div class="task-column">
            <h3>Done</h3>
            <div id="tasks-done"></div>
          </div>
        </div>
      </div>

      <!-- CHANGELOG -->
      <div id="page-changelog" class="page">
        <div class="page-header">
          <div>
            <h1>Changelog</h1>
            <p>Track what you change over time.</p>
          </div>
          <div>
            <button class="btn small" onclick="openModal('changelog')">Add Entry</button>
          </div>
        </div>

        <div id="changelog-list" class="grid"></div>
      </div>

      <!-- SNIPPETS -->
      <div id="page-snippets" class="page">
        <div class="page-header">
          <div>
            <h1>Snippets</h1>
            <p>Store useful code or command examples.</p>
          </div>
          <div>
            <button class="btn small" onclick="openModal('snippet')">Add Snippet</button>
          </div>
        </div>

        <div id="snippets-list" class="grid"></div>
      </div>

      <!-- PROFILE -->
      <div id="page-profile" class="page">
        <div class="page-header">
          <div>
            <h1>Profile</h1>
            <p>Local profile for this hub.</p>
          </div>
        </div>

        <div class="card">
          <div class="profile-row">
            <div class="avatar" id="avatar-initials">SD</div>
            <div>
              <div><strong id="profile-name">Guest</strong></div>
              <small id="profile-tagline">Shadowtech Dev user</small>
            </div>
          </div>
          <div style="margin-top:10px;">
            <button class="btn small" onclick="changeProfile()">Edit Profile</button>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="page-settings" class="page">
        <div class="page-header">
          <div>
            <h1>Settings</h1>
            <p>Local settings for this hub.</p>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <h2>Theme</h2>
            <p>Toggle between default and high‚Äëcontrast mode.</p>
            <button class="btn small" onclick="toggleTheme()">Toggle Theme</button>
          </div>
          <div class="card">
            <h2>Data</h2>
            <p>Clear all saved local data for this user (forum, profile, changelog, snippets, tasks).</p>
            <button class="btn small danger" onclick="clearAllData()">Clear All Local Data</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->
<div id="modal-bg">
  <div id="modal">
    <h3 id="modal-title">Modal</h3>
    <div id="modal-body"></div>
    <div style="margin-top:10px; text-align:right;">
      <button class="btn small secondary" onclick="closeModal()">Cancel</button>
      <button class="btn small" id="modal-confirm">Save</button>
    </div>
  </div>
</div>

<script>
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => document.querySelectorAll(sel);

document.getElementById('footer-year').textContent = new Date().getFullYear();

/* ===== AUTH SYSTEM (LOCAL) ===== */
let authMode = 'login'; // 'login' or 'register'
let currentUser = null; // { username, profile, data keys }

function getUsers() {
  return JSON.parse(localStorage.getItem('shadowtech_users') || '{}');
}

function saveUsers(users) {
  localStorage.setItem('shadowtech_users', JSON.stringify(users));
}

// super simple hash (not secure, just obfuscation)
function hashPassword(pw) {
  let h = 0;
  for (let i = 0; i < pw.length; i++) {
    h = (h * 31 + pw.charCodeAt(i)) >>> 0;
  }
  return h.toString(16);
}

function setAuthMode(mode) {
  authMode = mode;
  $$('#login-tabs .login-tab').forEach(tab => {
    tab.classList.toggle('active', tab.getAttribute('data-mode') === mode);
  });
  $('#login-error').textContent = '';
  $('#login-password').value = '';
}

$$('#login-tabs .login-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    setAuthMode(tab.getAttribute('data-mode'));
  });
});

function handleAuth() {
  const username = $('#login-username').value.trim();
  const password = $('#login-password').value.trim();
  const errorEl = $('#login-error');

  if (!username || !password) {
    errorEl.textContent = 'Enter username and password.';
    return;
  }

  const users = getUsers();

  if (authMode === 'register') {
    if (users[username]) {
      errorEl.textContent = 'Username already exists.';
      return;
    }
    users[username] = {
      passwordHash: hashPassword(password),
      profile: {
        name: username,
        tagline: 'Shadowtech Dev user'
      }
    };
    saveUsers(users);
    errorEl.textContent = 'Account created. You can log in now.';
    setAuthMode('login');
    return;
  }

  // login
  if (!users[username]) {
    errorEl.textContent = 'User not found.';
    return;
  }
  if (users[username].passwordHash !== hashPassword(password)) {
    errorEl.textContent = 'Incorrect password.';
    return;
  }

  currentUser = username;
  localStorage.setItem('shadowtech_current_user', username);
  $('#login-screen').style.display = 'none';
  $('#app').style.display = 'flex';
  initApp();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('shadowtech_current_user');
  $('#app').style.display = 'none';
  $('#login-screen').style.display = 'flex';
  $('#login-password').value = '';
  $('#login-error').textContent = '';
}

/* Auto-login if user exists */
(function autoLogin() {
  const savedUser = localStorage.getItem('shadowtech_current_user');
  const users = getUsers();
  if (savedUser && users[savedUser]) {
    currentUser = savedUser;
    $('#login-screen').style.display = 'none';
    $('#app').style.display = 'flex';
    initApp();
  }
})();

/* ===== NAVIGATION ===== */
function initNav() {
  $$('.sidebar-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const page = btn.getAttribute('data-page');
      goTo(page);
    });
  });
}

function goTo(page) {
  $$('.sidebar-btn').forEach(b => b.classList.remove('active'));
  const activeBtn = document.querySelector(`.sidebar-btn[data-page="${page}"]`);
  if (activeBtn) activeBtn.classList.add('active');

  $$('.page').forEach(p => p.classList.remove('active'));
  const pageDiv = document.getElementById('page-' + page);
  if (pageDiv) pageDiv.classList.add('active');

  $('#topbar-page-label').textContent = page.charAt(0).toUpperCase() + page.slice(1);
}

/* ===== PROFILE / TOPBAR ===== */
let profile = { name: 'Guest', tagline: 'Shadowtech Dev user' };

function loadProfile() {
  const users = getUsers();
  if (currentUser && users[currentUser] && users[currentUser].profile) {
    profile = users[currentUser].profile;
  } else {
    profile = { name: currentUser || 'Guest', tagline: 'Shadowtech Dev user' };
  }
}

function saveProfile() {
  const users = getUsers();
  if (!currentUser) return;
  if (!users[currentUser]) return;
  users[currentUser].profile = profile;
  saveUsers(users);
}

function renderProfile() {
  $('#profile-name').textContent = profile.name;
  $('#profile-tagline').textContent = profile.tagline;
  const initials = profile.name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
  $('#avatar-initials').textContent = initials || 'SD';
  $('#topbar-name').textContent = profile.name;
  $('#topbar-avatar').textContent = initials || 'SD';
}

function changeProfile() {
  const name = prompt('Enter display name:', profile.name);
  if (!name) return;
  const tagline = prompt('Enter tagline:', profile.tagline);
  profile.name = name;
  profile.tagline = tagline || profile.tagline;
  saveProfile();
  renderProfile();
}

/* ===== MODAL ===== */
let modalMode = null;
let modalExtra = null;

function openModal(mode, extra = null) {
  modalMode = mode;
  modalExtra = extra;
  const body = $('#modal-body');
  const title = $('#modal-title');
  body.innerHTML = '';

  if (mode === 'post') {
    title.textContent = 'New Forum Post';
    body.innerHTML = `
      <input id="post-title" placeholder="Title">
      <textarea id="post-body" rows="4" placeholder="Write something..."></textarea>
      <div id="emoji-picker">
        <span>üòÄ</span><span>üî•</span><span>‚öôÔ∏è</span><span>üíª</span><span>üêõ</span><span>‚úÖ</span>
      </div>
    `;
    setupEmojiPicker('post-body');
  } else if (mode === 'reply') {
    title.textContent = 'Reply to Post';
    body.innerHTML = `
      <textarea id="reply-body" rows="3" placeholder="Write a reply..."></textarea>
      <div id="emoji-picker">
        <span>üëç</span><span>üëÄ</span><span>üí°</span><span>‚ùó</span><span>‚úÖ</span>
      </div>
    `;
    setupEmojiPicker('reply-body');
  } else if (mode === 'changelog') {
    title.textContent = 'New Changelog Entry';
    body.innerHTML = `
      <input id="chg-title" placeholder="Title">
      <textarea id="chg-body" rows="3" placeholder="What changed?"></textarea>
    `;
  } else if (mode === 'snippet') {
    title.textContent = 'New Snippet';
    body.innerHTML = `
      <input id="snip-title" placeholder="Snippet title">
      <textarea id="snip-body" rows="4" placeholder="Code or commands..."></textarea>
    `;
  } else if (mode === 'task') {
    title.textContent = 'New Task';
    body.innerHTML = `
      <input id="task-title" placeholder="Task title">
      <select id="task-column">
        <option value="todo">To‚ÄëDo</option>
        <option value="progress">In Progress</option>
        <option value="done">Done</option>
      </select>
    `;
  }

  $('#modal-confirm').onclick = handleModalConfirm;
  $('#modal-bg').style.display = 'flex';
}

function closeModal() {
  $('#modal-bg').style.display = 'none';
  modalMode = null;
  modalExtra = null;
}

function setupEmojiPicker(targetId) {
  const picker = $('#emoji-picker');
  picker.querySelectorAll('span').forEach(span => {
    span.addEventListener('click', () => {
      const ta = document.getElementById(targetId);
      ta.value += span.textContent;
      ta.focus();
    });
  });
}

/* ===== PER-USER STORAGE KEYS ===== */
function keyFor(name) {
  return `shadowtech_${currentUser || 'guest'}_${name}`;
}

/* ===== FORUM DATA ===== */
let forumPosts = [];

function loadForum() {
  forumPosts = JSON.parse(localStorage.getItem(keyFor('forum')) || '[]');
}

function saveForum() {
  localStorage.setItem(keyFor('forum'), JSON.stringify(forumPosts));
}

function renderForum() {
  const container = $('#forum-posts');
  container.innerHTML = '';
  if (!forumPosts.length) {
    container.innerHTML = '<small style="color:var(--muted);">No posts yet. Create one to start your dev log.</small>';
    return;
  }

  forumPosts.forEach((post, index) => {
    let repliesHtml = '';
    if (post.replies && post.replies.length) {
      post.replies.forEach(r => {
        repliesHtml += `
          <div class="reply">
            <div><strong>${r.author}</strong> ‚Äî <small>${r.date}</small></div>
            <div>${r.body}</div>
          </div>
        `;
      });
    }

    container.innerHTML += `
      <div class="post">
        <div class="post-header">
          <div>${post.author}</div>
          <div>${post.date}</div>
        </div>
        <div class="post-title">${post.title}</div>
        <div class="post-body">${post.body}</div>
        ${repliesHtml}
        <div class="post-footer">
          <div>
            <button class="btn small secondary" onclick="openModal('reply', ${index})">Reply</button>
          </div>
          <div>
            <button class="btn small danger" onclick="deletePost(${index})">Delete</button>
          </div>
        </div>
      </div>
    `;
  });
}

function deletePost(index) {
  if (!confirm('Delete this post?')) return;
  forumPosts.splice(index, 1);
  saveForum();
  renderForum();
}

function clearForum() {
  if (!confirm('Clear all forum posts?')) return;
  forumPosts = [];
  saveForum();
  renderForum();
}

/* ===== CHANGELOG DATA ===== */
let changelog = [];

function loadChangelog() {
  changelog = JSON.parse(localStorage.getItem(keyFor('changelog')) || '[]');
}

function saveChangelog() {
  localStorage.setItem(keyFor('changelog'), JSON.stringify(changelog));
}

function renderChangelog() {
  const list = $('#changelog-list');
  list.innerHTML = '';
  if (!changelog.length) {
    list.innerHTML = '<small style="color:var(--muted);">No changelog entries yet.</small>';
    return;
  }
  changelog.slice().reverse().forEach(entry => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <strong>${entry.title}</strong><br>
      <small>${entry.date}</small>
      <p>${entry.body}</p>
    `;
    list.appendChild(card);
  });
}

/* ===== SNIPPETS DATA ===== */
let snippets = [];

function loadSnippets() {
  snippets = JSON.parse(localStorage.getItem(keyFor('snippets')) || '[]');
}

function saveSnippets() {
  localStorage.setItem(keyFor('snippets'), JSON.stringify(snippets));
}

function renderSnippets() {
  const list = $('#snippets-list');
  list.innerHTML = '';
  if (!snippets.length) {
    list.innerHTML = '<small style="color:var(--muted);">No snippets saved yet.</small>';
    return;
  }
  snippets.slice().reverse().forEach(sn => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <strong>${sn.title}</strong><br>
      <small>${sn.date}</small>
      <div class="code-block">${sn.body.replace(/</g, '&lt;')}</div>
    `;
    list.appendChild(card);
  });
}

/* ===== TASKS DATA ===== */
let tasks = { todo: [], progress: [], done: [] };

function loadTasks() {
  tasks = JSON.parse(localStorage.getItem(keyFor('tasks')) || '{"todo":[],"progress":[],"done":[]}');
}

function saveTasks() {
  localStorage.setItem(keyFor('tasks'), JSON.stringify(tasks));
}

function renderTasks() {
  const todo = $('#tasks-todo');
  const prog = $('#tasks-progress');
  const done = $('#tasks-done');
  todo.innerHTML = '';
  prog.innerHTML = '';
  done.innerHTML = '';

  tasks.todo.forEach((t, i) => {
    todo.innerHTML += `
      <div class="task-item">
        <span>${t}</span>
        <div>
          <button class="btn small secondary" onclick="moveTask('todo','progress',${i})">‚ñ∂</button>
          <button class="btn small danger" onclick="deleteTask('todo',${i})">‚úï</button>
        </div>
      </div>
    `;
  });

  tasks.progress.forEach((t, i) => {
    prog.innerHTML += `
      <div class="task-item">
        <span>${t}</span>
        <div>
          <button class="btn small secondary" onclick="moveTask('progress','done',${i})">‚úî</button>
          <button class="btn small secondary" onclick="moveTask('progress','todo',${i})">‚óÄ</button>
          <button class="btn small danger" onclick="deleteTask('progress',${i})">‚úï</button>
        </div>
      </div>
    `;
  });

  tasks.done.forEach((t, i) => {
    done.innerHTML += `
      <div class="task-item">
        <span>${t}</span>
        <div>
          <button class="btn small secondary" onclick="moveTask('done','progress',${i})">‚óÄ</button>
          <button class="btn small danger" onclick="deleteTask('done',${i})">‚úï</button>
        </div>
      </div>
    `;
  });
}

function moveTask(from, to, index) {
  const item = tasks[from][index];
  tasks[from].splice(index, 1);
  tasks[to].push(item);
  saveTasks();
  renderTasks();
}

function deleteTask(col, index) {
  tasks[col].splice(index, 1);
  saveTasks();
  renderTasks();
}

/* ===== WIKI DATA (STATIC) ===== */
const wikiData = [
  {
    id: 'overview',
    title: 'Overview',
    body: `
      <p>Shadowtech Dev Hub is your local control center for notes, forum posts, wiki entries, tasks, and dev tools.</p>
      <ul>
        <li>Use the <strong>Forum</strong> to log progress and ideas.</li>
        <li>Use the <strong>Wiki</strong> to document systems.</li>
        <li>Use <strong>Changelog</strong> and <strong>Snippets</strong> for dev work.</li>
        <li>Use <strong>Tasks</strong> to track what you‚Äôre doing.</li>
      </ul>
    `
  },
  {
    id: 'commands',
    title: 'Command Structure',
    body: `
      <p>Example structure for your bot commands:</p>
      <ul>
        <li><code>/admin</code> ‚Äî moderation, logging</li>
        <li><code>/utility</code> ‚Äî tools, info</li>
        <li><code>/fun</code> ‚Äî cosmetic & social</li>
        <li><code>/premium</code> ‚Äî gated features</li>
      </ul>
    `
  },
  {
    id: 'premium',
    title: 'Premium Logic',
    body: `
      <p>Owner‚Äëkey model:</p>
      <ul>
        <li>Owner generates keys with tiers.</li>
        <li>Users redeem keys via command.</li>
        <li>Bot checks tier before running premium commands.</li>
      </ul>
      <div class="code-block">
        if (!hasPremium(userId, "PRO")) {<br>
        &nbsp;&nbsp;return reply("You need PRO tier to use this.");<br>
        }
      </div>
    `
  }
];

function renderWikiTopics() {
  const container = $('#wiki-topics');
  container.innerHTML = '';
  wikiData.forEach((topic, i) => {
    const div = document.createElement('div');
    div.className = 'wiki-topic' + (i === 0 ? ' active' : '');
    div.textContent = topic.title;
    div.onclick = () => selectWiki(topic.id);
    container.appendChild(div);
  });
  selectWiki(wikiData[0].id);
}

function selectWiki(id) {
  const topic = wikiData.find(t => t.id === id);
  if (!topic) return;
  $$('#wiki-topics .wiki-topic').forEach(el => {
    el.classList.toggle('active', el.textContent === topic.title);
  });
  $('#wiki-content').innerHTML = `<h2>${topic.title}</h2>${topic.body}`;
}

/* ===== SETTINGS / THEME ===== */
let highContrast = false;

function loadTheme() {
  highContrast = JSON.parse(localStorage.getItem(keyFor('theme_hc')) || 'false');
  applyTheme();
}

function applyTheme() {
  if (highContrast) {
    document.body.style.filter = 'contrast(1.15) brightness(1.05)';
  } else {
    document.body.style.filter = 'none';
  }
}

function toggleTheme() {
  highContrast = !highContrast;
  localStorage.setItem(keyFor('theme_hc'), JSON.stringify(highContrast));
  applyTheme();
}

/* ===== CLEAR ALL DATA FOR USER ===== */
function clearAllData() {
  if (!confirm('Clear all local data for this user? This cannot be undone.')) return;
  localStorage.removeItem(keyFor('forum'));
  localStorage.removeItem(keyFor('changelog'));
  localStorage.removeItem(keyFor('snippets'));
  localStorage.removeItem(keyFor('tasks'));
  localStorage.removeItem(keyFor('theme_hc'));
  // profile stays (account-level)
  loadForum(); renderForum();
  loadChangelog(); renderChangelog();
  loadSnippets(); renderSnippets();
  loadTasks(); renderTasks();
  loadTheme();
}

/* ===== MODAL CONFIRM HANDLER ===== */
function handleModalConfirm() {
  if (modalMode === 'post') {
    const title = $('#post-title').value.trim();
    const body = $('#post-body').value.trim();
    if (!title || !body) return;
    forumPosts.push({
      title,
      body,
      author: profile.name || currentUser || 'Guest',
      date: new Date().toLocaleString(),
      replies: []
    });
    saveForum();
    renderForum();
  } else if (modalMode === 'reply') {
    const body = $('#reply-body').value.trim();
    if (!body) return;
    const idx = modalExtra;
    if (forumPosts[idx]) {
      forumPosts[idx].replies = forumPosts[idx].replies || [];
      forumPosts[idx].replies.push({
        body,
        author: profile.name || currentUser || 'Guest',
        date: new Date().toLocaleString()
      });
      saveForum();
      renderForum();
    }
  } else if (modalMode === 'changelog') {
    const title = $('#chg-title').value.trim();
    const body = $('#chg-body').value.trim();
    if (!title || !body) return;
    changelog.push({
      title,
      body,
      date: new Date().toLocaleString()
    });
    saveChangelog();
    renderChangelog();
  } else if (modalMode === 'snippet') {
    const title = $('#snip-title').value.trim();
    const body = $('#snip-body').value.trim();
    if (!title || !body) return;
    snippets.push({
      title,
      body,
      date: new Date().toLocaleString()
    });
    saveSnippets();
    renderSnippets();
  } else if (modalMode === 'task') {
    const title = $('#task-title').value.trim();
    const col = $('#task-column').value;
    if (!title) return;
    tasks[col].push(title);
    saveTasks();
    renderTasks();
  }

  closeModal();
}

/* ===== INIT APP AFTER LOGIN ===== */
function initApp() {
  loadProfile();
  renderProfile();
  renderTopbarProfile();
  initNav();
  loadForum(); renderForum();
  loadChangelog(); renderChangelog();
  loadSnippets(); renderSnippets();
  loadTasks(); renderTasks();
  renderWikiTopics();
  loadTheme();
}

function renderTopbarProfile() {
  const initials = profile.name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
  $('#topbar-name').textContent = profile.name;
  $('#topbar-avatar').textContent = initials || 'SD';
}
</script>

</body>
</html>
