<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shadowtech Bot Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #05060a;
  --bg-alt: #0b0e18;
  --panel: #141827;
  --panel-soft: #101321;
  --accent: #4b8cff;
  --accent-soft: rgba(75, 140, 255, 0.18);
  --accent-strong: #7b5cff;
  --text: #f5f7ff;
  --muted: #9aa0c2;
  --danger: #ff4b81;
  --border: #22263a;
  --radius: 8px;
  --shadow: 0 0 25px rgba(0,0,0,0.6);
  --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: var(--font);
  background: radial-gradient(circle at top, #151a33 0, #05060a 55%);
  color: var(--text);
  height: 100vh;
}

/* LAYOUT */
#app {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* SIDEBAR */
#sidebar {
  width: 260px;
  background: linear-gradient(180deg, var(--bg-alt), #05060a);
  border-right: 1px solid var(--border);
  padding: 14px;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow);
}

#sidebar-header {
  margin-bottom: 14px;
}

#bot-name {
  font-size: 0.9rem;
  font-weight: 600;
}

#bot-name span {
  color: var(--accent);
}

#bot-subtitle {
  font-size: 0.75rem;
  color: var(--muted);
}

.sidebar-section-title {
  font-size: 0.75rem;
  text-transform: uppercase;
  color: var(--muted);
  margin: 12px 0 6px;
}

.sidebar-btn {
  padding: 7px 10px;
  margin-bottom: 4px;
  background: transparent;
  border-radius: 6px;
  border: 1px solid transparent;
  cursor: pointer;
  text-align: left;
  color: var(--muted);
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.sidebar-btn span.icon {
  width: 20px;
  text-align: center;
}

.sidebar-btn:hover {
  background: var(--accent-soft);
  color: var(--text);
}

.sidebar-btn.active {
  background: var(--accent);
  color: #fff;
  border-color: var(--accent-strong);
}

#sidebar-footer {
  margin-top: auto;
  font-size: 0.7rem;
  color: var(--muted);
  border-top: 1px solid var(--border);
  padding-top: 8px;
}

/* MAIN WRAPPER */
#main-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* TOPBAR */
#topbar {
  height: 46px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  border-bottom: 1px solid var(--border);
  background: rgba(5,6,10,0.9);
  backdrop-filter: blur(10px);
}

#topbar-left {
  font-size: 0.85rem;
  color: var(--muted);
}

#topbar-right {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 0.8rem;
}

#topbar-badge {
  padding: 2px 8px;
  border-radius: 999px;
  background: var(--accent-soft);
  color: var(--accent);
  font-size: 0.7rem;
  text-transform: uppercase;
}

#topbar-user {
  display: flex;
  align-items: center;
  gap: 6px;
}

#topbar-avatar {
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: linear-gradient(135deg, var(--accent), var(--accent-strong));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 700;
}

/* MAIN CONTENT */
#main {
  flex: 1;
  padding: 16px 18px;
  overflow-y: auto;
}

.page {
  display: none;
}

.page.active {
  display: block;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 14px;
}

.page-header h1 {
  margin: 0;
  font-size: 1.3rem;
}

.page-header p {
  margin: 4px 0 0;
  font-size: 0.85rem;
  color: var(--muted);
}

/* CARDS / GRID */
.grid {
  display: grid;
  gap: 14px;
}

.grid-2 {
  grid-template-columns: repeat(2, minmax(0, 1fr));
}

.grid-3 {
  grid-template-columns: repeat(3, minmax(0, 1fr));
}

.card {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 12px 14px;
  box-shadow: var(--shadow);
  font-size: 0.9rem;
}

.card h2 {
  margin: 0 0 6px;
  font-size: 1rem;
}

.card small {
  color: var(--muted);
}

/* BUTTONS */
.btn {
  padding: 7px 12px;
  border-radius: 999px;
  border: 1px solid transparent;
  background: var(--accent);
  color: #fff;
  font-size: 0.85rem;
  cursor: pointer;
}

.btn.secondary {
  background: transparent;
  border-color: var(--accent-soft);
  color: var(--text);
}

.btn.danger {
  background: var(--danger);
}

.btn.small {
  padding: 4px 8px;
  font-size: 0.75rem;
}

.btn + .btn {
  margin-left: 6px;
}

/* BANNER */
#promo-banner {
  background: linear-gradient(135deg, #1b2140, #101321);
  border-radius: var(--radius);
  border: 1px solid var(--accent-soft);
  padding: 14px;
  display: grid;
  grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
  gap: 12px;
  margin-bottom: 16px;
}

#promo-left h2 {
  margin: 0 0 4px;
  font-size: 1.1rem;
}

#promo-left small {
  color: var(--muted);
}

#promo-badges {
  margin-top: 6px;
  font-size: 0.8rem;
}

.promo-check {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  margin-right: 10px;
  color: var(--muted);
}

.promo-check span.icon {
  color: #4ade80;
}

#promo-buttons {
  margin-top: 10px;
}

#promo-right {
  font-size: 0.8rem;
  color: var(--muted);
}

/* CHECKLIST */
#checklist {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 10px 12px;
  font-size: 0.85rem;
}

.check-item {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 6px;
}

.check-item span.icon {
  width: 16px;
  text-align: center;
}

/* BUILDER LAYOUT */
.builder-layout {
  display: grid;
  grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
  gap: 14px;
}

.builder-panel {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 10px 12px;
  font-size: 0.85rem;
}

.builder-panel h2 {
  margin: 0 0 6px;
  font-size: 1rem;
}

.builder-panel label {
  display: block;
  margin-top: 6px;
  margin-bottom: 2px;
  font-size: 0.8rem;
  color: var(--muted);
}

.builder-panel input,
.builder-panel select,
.builder-panel textarea {
  width: 100%;
  padding: 7px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: #05060f;
  color: var(--text);
  font-family: var(--font);
  font-size: 0.85rem;
}

.builder-panel textarea {
  resize: vertical;
}

/* ACTION LIST */
.action-list {
  margin-top: 8px;
}

.action-item {
  background: #05060f;
  border-radius: 6px;
  border: 1px solid var(--border);
  padding: 6px 8px;
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.action-item-main {
  font-size: 0.8rem;
}

.action-item-controls button {
  margin-left: 4px;
}

/* LISTS */
.simple-list-item {
  background: var(--panel-soft);
  border-radius: 6px;
  border: 1px solid var(--border);
  padding: 6px 8px;
  margin-bottom: 6px;
  font-size: 0.85rem;
}

/* PRICING */
.pricing-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 14px;
}

.pricing-card {
  background: var(--panel);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  padding: 14px;
  box-shadow: var(--shadow);
  font-size: 0.9rem;
}

.pricing-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 4px;
}

.pricing-price {
  font-size: 1.4rem;
  font-weight: 700;
}

.pricing-old {
  font-size: 0.8rem;
  color: var(--muted);
  text-decoration: line-through;
  margin-left: 4px;
}

.pricing-save {
  font-size: 0.75rem;
  color: #4ade80;
  margin-left: 4px;
}

.pricing-features {
  margin-top: 8px;
  font-size: 0.8rem;
}

.pricing-features li {
  margin-bottom: 4px;
}

/* RESPONSIVE */
@media (max-width: 1000px) {
  #sidebar {
    display: none;
  }
  #app {
    flex-direction: column;
  }
  #main {
    padding: 12px;
  }
  #promo-banner {
    grid-template-columns: minmax(0, 1fr);
  }
  .builder-layout {
    grid-template-columns: minmax(0, 1fr);
  }
  .pricing-grid {
    grid-template-columns: minmax(0, 1fr);
  }
}
</style>
</head>
<body>

<div id="app">
  <!-- SIDEBAR -->
  <div id="sidebar">
    <div id="sidebar-header">
      <div id="bot-name">Shadows <span>Bot Builder</span></div>
      <div id="bot-subtitle">Shadowtech one‚Äëfile dev control</div>
    </div>

    <div class="sidebar-section-title">Modules</div>
    <button class="sidebar-btn active" data-page="dashboard">
      <span class="icon">üè†</span> Dashboard
    </button>
    <button class="sidebar-btn" data-page="command-builder">
      <span class="icon">üß©</span> Command Builder
    </button>
    <button class="sidebar-btn" data-page="event-builder">
      <span class="icon">‚ö°</span> Event Builder
    </button>
    <button class="sidebar-btn" data-page="message-builder">
      <span class="icon">üí¨</span> Message Builder
    </button>
    <button class="sidebar-btn" data-page="pricing">
      <span class="icon">üíé</span> Premium Plans
    </button>

    <div class="sidebar-section-title">Settings</div>
    <button class="sidebar-btn" data-page="settings">
      <span class="icon">‚öôÔ∏è</span> Settings
    </button>
    <button class="sidebar-btn" data-page="logs">
      <span class="icon">üìú</span> Logs
    </button>

    <div class="sidebar-section-title">Help</div>
    <button class="sidebar-btn" data-page="docs">
      <span class="icon">üìò</span> Docs / Wiki
    </button>

    <div class="sidebar-section-title">Your Custom Modules</div>
    <button class="sidebar-btn" data-page="custom-modules">
      <span class="icon">üß±</span> Custom Modules
    </button>

    <div id="sidebar-footer">
      Shadowtech Bot Builder<br>
      <span id="footer-year"></span>
    </div>
  </div>

  <!-- MAIN WRAPPER -->
  <div id="main-wrapper">
    <!-- TOPBAR -->
    <div id="topbar">
      <div id="topbar-left">
        <span id="topbar-page-label">Dashboard</span>
      </div>
      <div id="topbar-right">
        <span id="topbar-badge">Local Only</span>
        <div id="topbar-user">
          <div id="topbar-avatar">ST</div>
          <span>Owner</span>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main">
      <!-- DASHBOARD -->
      <div id="page-dashboard" class="page active">
        <div id="promo-banner">
          <div id="promo-left">
            <h2>Shadowtech Bot Builder ‚Äî One File, Full Control</h2>
            <small>Design commands, events, and messages in a BotGhost‚Äëstyle dashboard. All stored locally in your browser.</small>
            <div id="promo-badges">
              <span class="promo-check"><span class="icon">‚úî</span> Unlimited local commands</span>
              <span class="promo-check"><span class="icon">‚úî</span> Visual action builder</span>
              <span class="promo-check"><span class="icon">‚úî</span> No backend required</span>
            </div>
            <div id="promo-buttons">
              <button class="btn small" onclick="goTo('command-builder')">Open Command Builder</button>
              <button class="btn small secondary" onclick="goTo('event-builder')">Open Event Builder</button>
            </div>
          </div>
          <div id="promo-right">
            <strong>Quick Setup Checklist</strong>
            <div id="checklist">
              <div class="check-item">
                <span class="icon">‚¨ú</span> Invite your bot to your server
              </div>
              <div class="check-item">
                <span class="icon">‚¨ú</span> Create at least one command
              </div>
              <div class="check-item">
                <span class="icon">‚¨ú</span> Create at least one event
              </div>
              <div class="check-item">
                <span class="icon">‚¨ú</span> Build a reusable message
              </div>
              <div class="check-item">
                <span class="icon">‚¨ú</span> Explore premium layout ideas
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-3">
          <div class="card">
            <h2>Command Builder</h2>
            <small>Click to start building a custom command.</small>
            <p>Define triggers, add actions, and preview the flow visually.</p>
            <button class="btn small" onclick="goTo('command-builder')">Open Command Builder</button>
          </div>
          <div class="card">
            <h2>Event Builder</h2>
            <small>Click to start building a custom event.</small>
            <p>React to joins, messages, reactions, and more with visual actions.</p>
            <button class="btn small" onclick="goTo('event-builder')">Open Event Builder</button>
          </div>
          <div class="card">
            <h2>Message Builder</h2>
            <small>Create and manage reusable messages.</small>
            <p>Store welcome messages, error templates, and announcement layouts.</p>
            <button class="btn small" onclick="goTo('message-builder')">Open Message Builder</button>
          </div>
        </div>
      </div>

      <!-- COMMAND BUILDER -->
      <div id="page-command-builder" class="page">
        <div class="page-header">
          <div>
            <h1>Command Builder</h1>
            <p>Build custom commands with triggers and actions. Stored locally.</p>
          </div>
          <div>
            <button class="btn small secondary" onclick="resetCommandForm()">New Command</button>
          </div>
        </div>

        <div class="builder-layout">
          <div class="builder-panel">
            <h2>Command Settings</h2>
            <label for="cmd-name">Command Name</label>
            <input id="cmd-name" placeholder="e.g. ping, ban, help">

            <label for="cmd-trigger">Trigger Type</label>
            <select id="cmd-trigger">
              <option value="slash">Slash Command</option>
              <option value="prefix">Prefix Command</option>
              <option value="button">Button Interaction</option>
              <option value="menu">Select Menu</option>
            </select>

            <label for="cmd-desc">Description</label>
            <textarea id="cmd-desc" rows="3" placeholder="What this command does..."></textarea>

            <hr style="border-color:var(--border); margin:10px 0;">

            <h2>Actions</h2>
            <label for="action-type">Add Action</label>
            <select id="action-type">
              <option value="send-message">Send Message</option>
              <option value="reply-embed">Reply with Embed</option>
              <option value="add-role">Add Role</option>
              <option value="remove-role">Remove Role</option>
              <option value="dm-user">DM User</option>
              <option value="log-channel">Log to Channel</option>
            </select>

            <label for="action-content">Action Content</label>
            <textarea id="action-content" rows="2" placeholder="Message text, role ID, or details..."></textarea>

            <div style="margin-top:8px;">
              <button class="btn small" onclick="addCommandAction()">Add Action</button>
            </div>

            <div class="action-list" id="cmd-actions-list"></div>

            <div style="margin-top:10px; text-align:right;">
              <button class="btn small secondary" onclick="resetCommandForm()">Clear</button>
              <button class="btn small" onclick="saveCommand()">Save Command</button>
            </div>
          </div>

          <div class="builder-panel">
            <h2>Saved Commands</h2>
            <div id="cmd-saved-list"></div>
          </div>
        </div>
      </div>

      <!-- EVENT BUILDER -->
      <div id="page-event-builder" class="page">
        <div class="page-header">
          <div>
            <h1>Event Builder</h1>
            <p>Create events that react to server activity with actions.</p>
          </div>
          <div>
            <button class="btn small secondary" onclick="resetEventForm()">New Event</button>
          </div>
        </div>

        <div class="builder-layout">
          <div class="builder-panel">
            <h2>Event Settings</h2>
            <label for="evt-name">Event Name</label>
            <input id="evt-name" placeholder="e.g. memberJoin, messageLog">

            <label for="evt-trigger">Trigger</label>
            <select id="evt-trigger">
              <option value="member-join">Member Join</option>
              <option value="member-leave">Member Leave</option>
              <option value="message-create">Message Create</option>
              <option value="reaction-add">Reaction Add</option>
              <option value="voice-join">Voice Channel Join</option>
            </select>

            <label for="evt-desc">Description</label>
            <textarea id="evt-desc" rows="3" placeholder="What this event does..."></textarea>

            <hr style="border-color:var(--border); margin:10px 0;">

            <h2>Actions</h2>
            <label for="evt-action-type">Add Action</label>
            <select id="evt-action-type">
              <option value="send-message">Send Message</option>
              <option value="reply-embed">Reply with Embed</option>
              <option value="add-role">Add Role</option>
              <option value="log-channel">Log to Channel</option>
              <option value="dm-user">DM User</option>
            </select>

            <label for="evt-action-content">Action Content</label>
            <textarea id="evt-action-content" rows="2" placeholder="Message text, role ID, or details..."></textarea>

            <div style="margin-top:8px;">
              <button class="btn small" onclick="addEventAction()">Add Action</button>
            </div>

            <div class="action-list" id="evt-actions-list"></div>

            <div style="margin-top:10px; text-align:right;">
              <button class="btn small secondary" onclick="resetEventForm()">Clear</button>
              <button class="btn small" onclick="saveEvent()">Save Event</button>
            </div>
          </div>

          <div class="builder-panel">
            <h2>Saved Events</h2>
            <div id="evt-saved-list"></div>
          </div>
        </div>
      </div>

      <!-- MESSAGE BUILDER -->
      <div id="page-message-builder" class="page">
        <div class="page-header">
          <div>
            <h1>Message Builder</h1>
            <p>Create reusable messages for commands and events.</p>
          </div>
        </div>

        <div class="builder-layout">
          <div class="builder-panel">
            <h2>New Message</h2>
            <label for="msg-title">Message Title</label>
            <input id="msg-title" placeholder="e.g. Welcome Message, Error Template">

            <label for="msg-body">Message Content</label>
            <textarea id="msg-body" rows="4" placeholder="Message text, placeholders, etc."></textarea>

            <div style="margin-top:8px; text-align:right;">
              <button class="btn small secondary" onclick="resetMessageForm()">Clear</button>
              <button class="btn small" onclick="saveMessage()">Save Message</button>
            </div>
          </div>

          <div class="builder-panel">
            <h2>Saved Messages</h2>
            <div id="msg-saved-list"></div>
          </div>
        </div>
      </div>

      <!-- PRICING -->
      <div id="page-pricing" class="page">
        <div class="page-header">
          <div>
            <h1>Premium Layout Ideas</h1>
            <p>Inspired by BotGhost‚Äëstyle Single Bot vs Unlimited Bots plans.</p>
          </div>
        </div>

        <div class="pricing-grid">
          <div class="pricing-card">
            <div class="pricing-label">Single Bot</div>
            <div>
              <span class="pricing-price">$3.50</span>
              <span class="pricing-old">$5.00</span>
              <span class="pricing-save">SAVE 30%</span>
            </div>
            <small>Billed annually ‚Äî $42.00</small>
            <div class="pricing-features">
              <ul>
                <li>Premium layout for one bot project</li>
                <li>Unlimited local commands & events</li>
                <li>Unlimited servers (your side)</li>
                <li>Custom status & branding</li>
                <li>Priority ‚Äúyou‚Äëonly‚Äù config space</li>
              </ul>
            </div>
            <button class="btn small">Use Single Bot Layout</button>
          </div>

          <div class="pricing-card">
            <div class="pricing-label">Unlimited Bots (Most Popular)</div>
            <div>
              <span class="pricing-price">$7.00</span>
              <span class="pricing-old">$10.00</span>
              <span class="pricing-save">SAVE 30%</span>
            </div>
            <small>Billed annually ‚Äî $84.00</small>
            <div class="pricing-features">
              <ul>
                <li>Unlimited bot projects in this builder</li>
                <li>Unlimited commands & events per bot</li>
                <li>Custom branding across all workspaces</li>
                <li>Future bots automatically use this layout</li>
                <li>‚ÄúShadowtech Owner‚Äù priority section</li>
              </ul>
            </div>
            <button class="btn small">Use Unlimited Layout</button>
          </div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="page-settings" class="page">
        <div class="page-header">
          <div>
            <h1>Settings</h1>
            <p>Local settings for this builder.</p>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <h2>Theme</h2>
            <p>Toggle high‚Äëcontrast mode for better visibility.</p>
            <button class="btn small" onclick="toggleTheme()">Toggle Theme</button>
          </div>
          <div class="card">
            <h2>Data</h2>
            <p>Clear all saved commands, events, and messages from this browser.</p>
            <button class="btn small danger" onclick="clearAllData()">Clear All Local Data</button>
          </div>
        </div>
      </div>

      <!-- LOGS -->
      <div id="page-logs" class="page">
        <div class="page-header">
          <div>
            <h1>Logs</h1>
            <p>Fake console output for testing flows.</p>
          </div>
        </div>

        <div class="card">
          <h2>Console</h2>
          <small>Click ‚ÄúTest Command Flow‚Äù from Command Builder to push logs here.</small>
          <div id="logs-output" class="code-block" style="margin-top:8px; max-height:260px; overflow-y:auto;"></div>
        </div>
      </div>

      <!-- DOCS / WIKI -->
      <div id="page-docs" class="page">
        <div class="page-header">
          <div>
            <h1>Docs / Wiki</h1>
            <p>Quick reference for how this one‚Äëfile builder works.</p>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="card">
            <h2>Storage Model</h2>
            <p>Everything is stored in <code>localStorage</code> under keys:</p>
            <ul>
              <li><code>st_commands</code> ‚Äî list of commands</li>
              <li><code>st_events</code> ‚Äî list of events</li>
              <li><code>st_messages</code> ‚Äî list of reusable messages</li>
              <li><code>st_theme_hc</code> ‚Äî theme toggle</li>
            </ul>
          </div>
          <div class="card">
            <h2>Export Idea</h2>
            <p>You can later add an ‚ÄúExport JSON‚Äù button to dump commands/events/messages into a file and feed that into a real bot backend.</p>
          </div>
        </div>
      </div>

      <!-- CUSTOM MODULES -->
      <div id="page-custom-modules" class="page">
        <div class="page-header">
          <div>
            <h1>Custom Modules</h1>
            <p>Placeholder area for future custom builders.</p>
          </div>
        </div>

        <div class="card">
          <p>Use this section later for things like:</p>
          <ul>
            <li>Premium key manager</li>
            <li>Flow builder</li>
            <li>Dashboard widgets</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const $ = (s) => document.querySelector(s);
const $$ = (s) => document.querySelectorAll(s);

document.getElementById('footer-year').textContent = new Date().getFullYear();

/* NAVIGATION */
$$('.sidebar-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const page = btn.getAttribute('data-page');
    goTo(page);
  });
});

function goTo(page) {
  $$('.sidebar-btn').forEach(b => b.classList.remove('active'));
  const activeBtn = document.querySelector(\`.sidebar-btn[data-page="\${page}"]\`);
  if (activeBtn) activeBtn.classList.add('active');

  $$('.page').forEach(p => p.classList.remove('active'));
  const pageDiv = document.getElementById('page-' + page);
  if (pageDiv) pageDiv.classList.add('active');

  $('#topbar-page-label').textContent = page
    .split('-')
    .map(w => w.charAt(0).toUpperCase() + w.slice(1))
    .join(' ');
}

/* THEME */
let highContrast = JSON.parse(localStorage.getItem('st_theme_hc') || 'false');
applyTheme();

function applyTheme() {
  if (highContrast) {
    document.body.style.filter = 'contrast(1.15) brightness(1.05)';
  } else {
    document.body.style.filter = 'none';
  }
}

function toggleTheme() {
  highContrast = !highContrast;
  localStorage.setItem('st_theme_hc', JSON.stringify(highContrast));
  applyTheme();
}

/* DATA STRUCTURES */
let commands = JSON.parse(localStorage.getItem('st_commands') || '[]');
let events = JSON.parse(localStorage.getItem('st_events') || '[]');
let messages = JSON.parse(localStorage.getItem('st_messages') || '[]');

let currentCmdActions = [];
let currentEvtActions = [];

/* COMMAND BUILDER */
function resetCommandForm() {
  $('#cmd-name').value = '';
  $('#cmd-trigger').value = 'slash';
  $('#cmd-desc').value = '';
  $('#action-type').value = 'send-message';
  $('#action-content').value = '';
  currentCmdActions = [];
  renderCommandActions();
}

function addCommandAction() {
  const type = $('#action-type').value;
  const content = $('#action-content').value.trim();
  if (!content) return;
  currentCmdActions.push({ type, content });
  $('#action-content').value = '';
  renderCommandActions();
}

function renderCommandActions() {
  const list = $('#cmd-actions-list');
  list.innerHTML = '';
  if (!currentCmdActions.length) {
    list.innerHTML = '<small style="color:var(--muted);">No actions yet. Add one above.</small>';
    return;
  }
  currentCmdActions.forEach((a, i) => {
    const div = document.createElement('div');
    div.className = 'action-item';
    div.innerHTML = \`
      <div class="action-item-main">
        <strong>\${a.type}</strong><br>
        <span>\${a.content}</span>
      </div>
      <div class="action-item-controls">
        <button class="btn small secondary" onclick="moveCmdAction(\${i}, -1)">‚ñ≤</button>
        <button class="btn small secondary" onclick="moveCmdAction(\${i}, 1)">‚ñº</button>
        <button class="btn small danger" onclick="deleteCmdAction(\${i})">‚úï</button>
      </div>
    \`;
    list.appendChild(div);
  });
}

function moveCmdAction(index, dir) {
  const newIndex = index + dir;
  if (newIndex < 0 || newIndex >= currentCmdActions.length) return;
  const temp = currentCmdActions[index];
  currentCmdActions[index] = currentCmdActions[newIndex];
  currentCmdActions[newIndex] = temp;
  renderCommandActions();
}

function deleteCmdAction(index) {
  currentCmdActions.splice(index, 1);
  renderCommandActions();
}

function saveCommand() {
  const name = $('#cmd-name').value.trim();
  const trigger = $('#cmd-trigger').value;
  const desc = $('#cmd-desc').value.trim();
  if (!name) return alert('Command name required.');
  const cmd = {
    id: Date.now(),
    name,
    trigger,
    desc,
    actions: currentCmdActions.slice()
  };
  commands.push(cmd);
  localStorage.setItem('st_commands', JSON.stringify(commands));
  renderSavedCommands();
  alert('Command saved locally.');
}

function renderSavedCommands() {
  const list = $('#cmd-saved-list');
  list.innerHTML = '';
  if (!commands.length) {
    list.innerHTML = '<small style="color:var(--muted);">No commands saved yet.</small>';
    return;
  }
  commands.slice().reverse().forEach(cmd => {
    const div = document.createElement('div');
    div.className = 'simple-list-item';
    div.innerHTML = \`
      <strong>\${cmd.name}</strong> ‚Äî <small>\${cmd.trigger}</small><br>
      <span style="color:var(--muted);">\${cmd.desc || 'No description'}</span><br>
      <small>\${cmd.actions.length} actions</small>
    \`;
    list.appendChild(div);
  });
}

/* EVENT BUILDER */
function resetEventForm() {
  $('#evt-name').value = '';
  $('#evt-trigger').value = 'member-join';
  $('#evt-desc').value = '';
  $('#evt-action-type').value = 'send-message';
  $('#evt-action-content').value = '';
  currentEvtActions = [];
  renderEventActions();
}

function addEventAction() {
  const type = $('#evt-action-type').value;
  const content = $('#evt-action-content').value.trim();
  if (!content) return;
  currentEvtActions.push({ type, content });
  $('#evt-action-content').value = '';
  renderEventActions();
}

function renderEventActions() {
  const list = $('#evt-actions-list');
  list.innerHTML = '';
  if (!currentEvtActions.length) {
    list.innerHTML = '<small style="color:var(--muted);">No actions yet. Add one above.</small>';
    return;
  }
  currentEvtActions.forEach((a, i) => {
    const div = document.createElement('div');
    div.className = 'action-item';
    div.innerHTML = \`
      <div class="action-item-main">
        <strong>\${a.type}</strong><br>
        <span>\${a.content}</span>
      </div>
      <div class="action-item-controls">
        <button class="btn small secondary" onclick="moveEvtAction(\${i}, -1)">‚ñ≤</button>
        <button class="btn small secondary" onclick="moveEvtAction(\${i}, 1)">‚ñº</button>
        <button class="btn small danger" onclick="deleteEvtAction(\${i})">‚úï</button>
      </div>
    \`;
    list.appendChild(div);
  });
}

function moveEvtAction(index, dir) {
  const newIndex = index + dir;
  if (newIndex < 0 || newIndex >= currentEvtActions.length) return;
  const temp = currentEvtActions[index];
  currentEvtActions[index] = currentEvtActions[newIndex];
  currentEvtActions[newIndex] = temp;
  renderEventActions();
}

function deleteEvtAction(index) {
  currentEvtActions.splice(index, 1);
  renderEventActions();
}

function saveEvent() {
  const name = $('#evt-name').value.trim();
  const trigger = $('#evt-trigger').value;
  const desc = $('#evt-desc').value.trim();
  if (!name) return alert('Event name required.');
  const evt = {
    id: Date.now(),
    name,
    trigger,
    desc,
    actions: currentEvtActions.slice()
  };
  events.push(evt);
  localStorage.setItem('st_events', JSON.stringify(events));
  renderSavedEvents();
  alert('Event saved locally.');
}

function renderSavedEvents() {
  const list = $('#evt-saved-list');
  list.innerHTML = '';
  if (!events.length) {
    list.innerHTML = '<small style="color:var(--muted);">No events saved yet.</small>';
    return;
  }
  events.slice().reverse().forEach(evt => {
    const div = document.createElement('div');
    div.className = 'simple-list-item';
    div.innerHTML = \`
      <strong>\${evt.name}</strong> ‚Äî <small>\${evt.trigger}</small><br>
      <span style="color:var(--muted);">\${evt.desc || 'No description'}</span><br>
      <small>\${evt.actions.length} actions</small>
    \`;
    list.appendChild(div);
  });
}

/* MESSAGE BUILDER */
function resetMessageForm() {
  $('#msg-title').value = '';
  $('#msg-body').value = '';
}

function saveMessage() {
  const title = $('#msg-title').value.trim();
  const body = $('#msg-body').value.trim();
  if (!title || !body) return alert('Title and content required.');
  const msg = {
    id: Date.now(),
    title,
    body
  };
  messages.push(msg);
  localStorage.setItem('st_messages', JSON.stringify(messages));
  renderSavedMessages();
  alert('Message saved locally.');
}

function renderSavedMessages() {
  const list = $('#msg-saved-list');
  list.innerHTML = '';
  if (!messages.length) {
    list.innerHTML = '<small style="color:var(--muted);">No messages saved yet.</small>';
    return;
  }
  messages.slice().reverse().forEach(m => {
    const div = document.createElement('div');
    div.className = 'simple-list-item';
    div.innerHTML = \`
      <strong>\${m.title}</strong><br>
      <span style="color:var(--muted); white-space:pre-wrap;">\${m.body}</span>
    \`;
    list.appendChild(div);
  });
}

/* LOGS (FAKE CONSOLE) */
function logToConsole(message) {
  const out = $('#logs-output');
  const line = document.createElement('div');
  line.textContent = '[' + new Date().toLocaleTimeString() + '] ' + message;
  out.appendChild(line);
  out.scrollTop = out.scrollHeight;
}

/* CLEAR ALL DATA */
function clearAllData() {
  if (!confirm('Clear all local commands, events, and messages?')) return;
  commands = [];
  events = [];
  messages = [];
  localStorage.removeItem('st_commands');
  localStorage.removeItem('st_events');
  localStorage.removeItem('st_messages');
  renderSavedCommands();
  renderSavedEvents();
  renderSavedMessages();
}

/* INIT */
function init() {
  renderSavedCommands();
  renderSavedEvents();
  renderSavedMessages();
}
init();
</script>

</body>
</html>
